<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube æ™ºæ…§æœå°‹æ’­æ”¾å™¨ - Appleé¢¨æ ¼</title>
    <style>
        :root {
            --bg-gradient: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
            --card-bg-glass: rgba(255, 255, 255, 0.65);
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #d1d5db;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.07);
            --modal-bg: rgba(249, 250, 251, 0.95);
            --accent-color: #3b82f6;
        }

        body.theme-dark {
            --bg-gradient: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            --card-bg-glass: rgba(31, 41, 55, 0.65);
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --modal-bg: rgba(23, 31, 42, 0.95);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 16px;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 32px; }
        .title { font-size: 2.5rem; font-weight: bold; margin-bottom: 8px; }
        .subtitle { color: var(--text-secondary); font-size: 1rem; }
        
        .search-card {
            background: var(--card-bg-glass); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color); border-radius: 16px; padding: 24px;
            box-shadow: var(--shadow); margin-bottom: 32px; position: relative;
        }
        .search-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .search-title { font-size: 1.25rem; font-weight: 600; }
        .theme-switcher { display: flex; gap: 4px; }
        .theme-btn { background: none; border: 1px solid var(--border-color); cursor: pointer; font-size: 0.9rem; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .theme-btn:hover { background-color: rgba(128, 128, 128, 0.2); }
        .search-form { display: flex; gap: 12px; }
        .search-input { flex: 1; padding: 12px 16px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1rem; outline: none; transition: all 0.2s; background-color: var(--card-bg-glass); color: var(--text-primary); }
        .search-input:focus { border-color: var(--accent-color); }
        .search-btn { color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: background-color 0.2s; background: var(--accent-color); }
        .search-btn:disabled { background: #9ca3af; cursor: not-allowed; }
        
        #searchHistory {
            display: none; position: absolute; top: 100%; left: 24px; right: 24px;
            background-color: var(--modal-bg); backdrop-filter: blur(10px);
            border: 1px solid var(--border-color); border-top: none;
            border-bottom-left-radius: 12px; border-bottom-right-radius: 12px;
            box-shadow: var(--shadow); z-index: 100; max-height: 250px; overflow-y: auto;
        }
        .history-item { padding: 12px 16px; cursor: pointer; transition: background-color 0.2s; color: var(--text-secondary); border-bottom: 1px solid var(--border-color); }
        .history-item:hover { background-color: rgba(128, 128, 128, 0.1); color: var(--text-primary); }
        #clearHistoryBtn { padding: 12px 16px; cursor: pointer; color: var(--accent-color); font-weight: 500; text-align: center; transition: background-color 0.2s; }
        #clearHistoryBtn:hover { background-color: rgba(128, 128, 128, 0.1); }

        .main-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 32px; }
        .player-card, .results-card { background: var(--card-bg-glass); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid var(--border-color); border-radius: 16px; padding: 24px; box-shadow: var(--shadow); }
        .player-title, .results-title { font-size: 1.25rem; font-weight: 600; }
        .results-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        #backToSearchBtn { background: none; border: 1px solid var(--border-color); color: var(--text-primary); padding: 4px 10px; border-radius: 6px; cursor: pointer; display: none; }
        .video-title { color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 16px; min-height: 2.5em; transition: color 0.3s; }
        
        .player-wrapper { text-align: center; cursor: pointer; }
        .player-container { position: relative; background: #000; border-radius: 12px; overflow: hidden; margin: 0 auto; transition: all 0.4s ease-in-out; width: 100%; max-width: 100%; aspect-ratio: 16/9; }
        .player-container.is-short { max-width: 340px; aspect-ratio: 9/16; }
        .player-area, #youtube-player { width: 100%; height: 100%; }
        .placeholder { color: var(--text-secondary); text-align: center; padding: 32px; }

        .player-controls { display: none; justify-content: center; gap: 12px; margin-top: 16px; transition: opacity 0.3s; }
        .player-control-btn { background-color: var(--card-bg-glass); border: 1px solid var(--border-color); color: var(--text-primary); padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.9rem; transition: all 0.2s; }
        .player-control-btn:hover { border-color: var(--accent-color); background-color: rgba(128,128,128,0.1); }

        .results-count { color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 16px; }
        .results-list { max-height: 520px; overflow-y: auto; padding-right: 8px; }
        .result-item { display: flex; gap: 16px; padding: 12px; border-radius: 12px; border: 1px solid transparent; margin-bottom: 16px; cursor: pointer; transition: all 0.2s ease; background-color: var(--card-bg-glass); }
        .result-item:hover { transform: translateY(-4px); box-shadow: 0 8px 15px rgba(0,0,0,0.1); border-color: var(--border-color); }
        .result-thumb { width: 120px; height: 90px; background-color: var(--border-color); border-radius: 8px; flex-shrink: 0; object-fit: cover; }
        .result-thumb.channel { border-radius: 50%; }
        .result-info { flex: 1; min-width: 0; display: flex; flex-direction: column; }
        .result-title { font-size: 1rem; font-weight: 600; margin-bottom: 8px; color: var(--text-primary); }
        .result-channel { color: var(--text-secondary); font-size: 0.8rem; margin-top: auto; }
        .result-badge { font-size: 0.7rem; padding: 2px 8px; border-radius: 99px; color: white; margin-bottom: 8px; align-self: flex-start; }
        .badge-video { background-color: #ef4444; } .badge-playlist { background-color: #3b82f6; } .badge-channel { background-color: #16a34a; }
        
        #confirmationModal { /* ... æ¨£å¼ä¸è®Š ... */ }

        @media (max-width: 768px) { /* ... æ¨£å¼ä¸è®Š ... */ }
    </style>
</head>
<body class="theme-light">
    <div class="container">
        <header class="header">
            <h1 class="title">YouTube æ™ºæ…§æœå°‹æ’­æ”¾å™¨</h1>
            <p class="subtitle">å³æ™‚æ’­æ”¾ãƒ»æ™ºæ…§é«”é©—</p>
        </header>

        <section class="search-card">
            <div class="search-header">
                <h2 class="search-title">ğŸ” æœå°‹å…§å®¹</h2>
                <div class="theme-switcher"><!-- ... --></div>
            </div>
            <div class="search-form">
                <input type="text" id="searchInput" class="search-input" placeholder="è¼¸å…¥é—œéµå­—..." autocomplete="off">
                <button id="searchBtn" class="search-btn">æœå°‹</button>
            </div>
            <div id="searchHistory"></div>
        </section>

        <main class="main-grid" id="mainGrid">
            <section class="player-card" id="playerCard">
                <h2 class="player-title">å½±ç‰‡æ’­æ”¾å™¨</h2>
                <div class="video-title" id="videoTitle">é»æ“Šæœå°‹çµæœä¸­çš„å½±ç‰‡ä»¥ç«‹å³æ’­æ”¾</div>
                <div class="player-wrapper" id="playerWrapper" title="å¿«é€ŸæŒ‰å…©ä¸‹å¯å…¨è¢å¹•æ’­æ”¾">
                    <div class="player-container" id="playerContainer">
                        <div class="player-area">
                            <div id="placeholder" class="placeholder">æ’­æ”¾å™¨å€åŸŸ</div>
                            <div id="youtube-player" style="display: none;"></div>
                        </div>
                    </div>
                    <div class="player-controls" id="playerControls">
                        <button id="copyUrlBtn" class="player-control-btn">ğŸ”— è¤‡è£½ç¶²å€</button>
                    </div>
                </div>
            </section>

            <section class="results-card" id="resultsCard"><!-- ... --></section>
        </main>
    </div>

    <div id="confirmationModal"><!-- ... --></div>
    <button id="scrollToTopBtn" title="è¿”å›é ‚éƒ¨">â¬†ï¸</button>

    <script>
        // âš ï¸âš ï¸âš ï¸ [æ¥µåº¦é‡è¦] å®‰å…¨è­¦å‘Š âš ï¸âš ï¸âš ï¸
        // åœ¨ä»»ä½•å…¬é–‹çš„å°ˆæ¡ˆä¸­ï¼Œæ‚¨ã€Œçµ•å°ä¸èƒ½ã€å°‡ API é‡‘é‘°ç›´æ¥å¯«åœ¨å‰ç«¯ç¨‹å¼ç¢¼ä¸­ã€‚
        // é€™æœƒè®“æ‚¨çš„é‡‘é‘°è¢«ç›œç”¨ï¼Œå°è‡´ API é…é¡è€—ç›¡æˆ–ç”¢ç”Ÿè²»ç”¨ã€‚
        // æ­£ç¢ºåšæ³•æ˜¯ï¼šå»ºç«‹ä¸€å€‹å¾Œç«¯ä¼ºæœå™¨ï¼Œç”±æ‚¨çš„å¾Œç«¯å»å‘¼å« YouTube APIã€‚
        const YOUTUBE_API_KEY = 'AIzaSyDjypfpOwmfNGhF61lXdkZ-DtybwNv0aTg';
        
        let player;
        let currentVideoId = null;
        let lastSearchResults = { html: '', count: '', title: '' };

        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        document.addEventListener('DOMContentLoaded', () => {
            applyTheme(localStorage.getItem('youtubePlayerTheme') || 'light');
            loadYouTubeAPI();
            setupEventListeners();
            loadSearchHistory();
        });

        function setupEventListeners() {
            $('#lightThemeBtn').addEventListener('click', () => applyTheme('light'));
            $('#darkThemeBtn').addEventListener('click', () => applyTheme('dark'));
            $('#searchBtn').addEventListener('click', () => searchContent());
            $('#searchInput').addEventListener('keypress', (e) => { if (e.key === 'Enter') { e.preventDefault(); searchContent(); } });
            
            $('#searchInput').addEventListener('focus', showSearchHistory);
            document.addEventListener('click', (e) => {
                if (!$('.search-card').contains(e.target)) {
                    $('#searchHistory').style.display = 'none';
                }
            });

            // æ’­æ”¾å™¨äº‹ä»¶
            $('#playerWrapper').addEventListener('dblclick', toggleFullScreen);
            $('#copyUrlBtn').addEventListener('click', copyVideoUrl);

            $('#modalCloseBtn').addEventListener('click', hideConfirmationModal);
            // ... å…¶ä»–äº‹ä»¶ç›£è½
        }

        // ... çœç•¥éƒ¨åˆ†ä¸è®Šçš„å‡½å¼: applyTheme, loadYouTubeAPI, showLoadingSkeletons, apiFetch ...

        async function searchContent() {
            // ... æœå°‹é‚è¼¯ä¸è®Š
        }
        
        function displayResults(items, title) {
            $('#resultsTitle').textContent = title;
            if (items.length === 0) {
                $('#resultsList').innerHTML = '<div class="empty-state">æ²’æœ‰æ‰¾åˆ°ç›¸é—œå…§å®¹</div>';
                $('#resultsCount').textContent = '';
                return;
            }
            $('#resultsCount').textContent = `æ‰¾åˆ° ${items.length} å€‹çµæœ`;
            $('#resultsList').innerHTML = items.map(item => {
                const { id, snippet } = item;
                const thumbnailUrl = snippet.thumbnails.medium?.url || '';
                const escapedTitle = snippet.title.replace(/'/g, "\\'").replace(/"/g, """);
                let onclickAction = '';

                switch (id.kind) {
                    case 'youtube#video':
                        // ***æ ¸å¿ƒæ”¹å‹•ï¼šå½±ç‰‡ç›´æ¥æ’­æ”¾***
                        onclickAction = `playItem('${id.videoId}', '${escapedTitle}', 'video')`;
                        return createResultItem('video', onclickAction, thumbnailUrl, snippet.title, snippet.channelTitle);
                    case 'youtube#playlist':
                        onclickAction = `showConfirmationModal('${id.playlistId}', 'playlist')`;
                        return createResultItem('playlist', onclickAction, thumbnailUrl, snippet.title, `ç”± ${snippet.channelTitle} å»ºç«‹`);
                    case 'youtube#channel':
                        onclickAction = `showConfirmationModal('${id.channelId}', 'channel')`;
                        return createResultItem('channel', onclickAction, thumbnailUrl, snippet.title, snippet.description || 'é»æ“ŠæŸ¥çœ‹é »é“å½±ç‰‡', true);
                }
            }).join('');
        }

        // ... createResultItem, showConfirmationModal ç­‰å‡½å¼ä¿æŒä¸è®Š

        // --- æœå°‹æ­·å²ç´€éŒ„ ---
        function getSearchHistory() { return JSON.parse(localStorage.getItem('youtubeSearchHistory') || '[]'); }

        function saveSearchHistory(query) {
            let history = getSearchHistory().filter(item => item !== query);
            history.unshift(query);
            if (history.length > 5) history = history.slice(0, 5);
            localStorage.setItem('youtubeSearchHistory', JSON.stringify(history));
            loadSearchHistory();
        }

        function loadSearchHistory() {
            const history = getSearchHistory();
            const historyContainer = $('#searchHistory');
            let historyHtml = history.map(item => `<div class="history-item">${item}</div>`).join('');
            if(history.length > 0) {
                historyHtml += `<div id="clearHistoryBtn">æ¸…é™¤æ­·å²ç´€éŒ„</div>`;
            }
            historyContainer.innerHTML = historyHtml;
            
            $$('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    $('#searchInput').value = item.textContent;
                    searchContent();
                });
            });
            
            if ($('#clearHistoryBtn')) {
                $('#clearHistoryBtn').addEventListener('click', clearSearchHistory);
            }
        }
        
        function clearSearchHistory() {
            localStorage.removeItem('youtubeSearchHistory');
            loadSearchHistory();
            $('#searchHistory').style.display = 'none';
        }

        function showSearchHistory() {
            if (getSearchHistory().length > 0) {
                $('#searchHistory').style.display = 'block';
            }
        }

        // --- æ’­æ”¾å™¨ç›¸é—œ ---
        function playItem(id, title, type) {
            currentVideoId = (type === 'video') ? id : null;
            $('#videoTitle').textContent = title;
            $('#videoTitle').style.color = 'var(--text-primary)';
            $('#placeholder').style.display = 'none';
            $('#youtube-player').style.display = 'block';
            $('#playerControls').style.display = 'flex';
            
            $('#playerCard').scrollIntoView({ behavior: 'smooth', block: 'center' });

            const isShort = title.toLowerCase().includes('#shorts');
            $('#playerContainer').classList.toggle('is-short', isShort);
            
            const playerOptions = {
                height: '100%', width: '100%',
                playerVars: { 'autoplay': 1, 'controls': 1, 'rel': 0 },
                events: {
                    'onReady': () => { /* æœªä¾†å¯ç”¨ */ },
                    'onStateChange': () => { /* æœªä¾†å¯ç”¨ */ }
                }
            };

            if (type === 'playlist') {
                playerOptions.playerVars.listType = 'playlist';
                playerOptions.playerVars.list = id;
            } else {
                playerOptions.videoId = id;
            }

            if (player) {
                if (type === 'video') player.loadVideoById(id);
                else player.loadPlaylist({ list: id, listType: 'playlist' });
            } else {
                player = new YT.Player('youtube-player', playerOptions);
            }
        }

        function toggleFullScreen() {
            const playerIframe = $('#youtube-player');
            if (!playerIframe || !player) return; // ç¢ºä¿æ’­æ”¾å™¨å­˜åœ¨

            if (document.fullscreenElement || document.webkitFullscreenElement) {
                if (document.exitFullscreen) document.exitFullscreen();
                else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            } else {
                const playerElement = player.getIframe();
                if (playerElement.requestFullscreen) playerElement.requestFullscreen();
                else if (playerElement.webkitRequestFullscreen) playerElement.webkitRequestFullscreen();
            }
        }

        function copyVideoUrl() {
            if (!currentVideoId) {
                alert('ç›®å‰æ’­æ”¾çš„ä¸æ˜¯å–®ä¸€å½±ç‰‡ï¼Œç„¡æ³•è¤‡è£½ç¶²å€ã€‚');
                return;
            }
            const url = `https://www.youtube.com/watch?v=${currentVideoId}`;
            navigator.clipboard.writeText(url).then(() => {
                const btn = $('#copyUrlBtn');
                const originalText = btn.innerHTML;
                btn.innerHTML = 'âœ… å·²è¤‡è£½!';
                setTimeout(() => { btn.innerHTML = originalText; }, 2000);
            }).catch(err => { alert('è¤‡è£½å¤±æ•—: ', err); });
        }
    </script>
</body>
</html>
